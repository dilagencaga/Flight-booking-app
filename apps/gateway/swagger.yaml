openapi: 3.0.0
info:
  title: Airline Ticketing System API
  version: 1.0.0
  description: API Gateway documentation for the Microservices implementation.

servers:
  - url: /

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:
    Flight:
      type: object
      properties:
        id:
          type: integer
        code:
          type: string
        from:
          type: string
        to:
          type: string
        date:
          type: string
        price:
          type: number
        capacity:
          type: integer
        duration:
          type: integer

security:
  - bearerAuth: []

paths:
  /auth/login:
    post:
      summary: Admin Login
      description: Returns a JWT token for admin operations. (User: admin / Pass: admin123)
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                username:
                  type: string
                  example: admin
                password:
                  type: string
                  example: admin123
      responses:
        200:
          description: Successful login
          content:
            application/json:
              schema:
                type: object
                properties:
                  token:
                    type: string
        401:
          description: Invalid credentials

  /v1/auth/login:
    post:
      summary: User Login (Cognito)
      description: Login for standard users.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                email:
                  type: string
                password:
                  type: string
      responses:
        200:
          description: Successful login
        401:
          description: Unauthorized

  /v1/flights:
    get:
      summary: List All Flights (Public)
      description: Retrieve a list of all available flights.
      responses:
        200:
          description: A list of flights
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Flight'

  /v1/flights/admin:
    get:
      summary: Added Flight By Admin
      description: List all flights added to the system (Admin View).
      responses:
        200:
          description: A list of flights
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Flight'
  /v1/flights/add:
    post:
      summary: Add a new flight (Admin Only)
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                code:
                  type: string
                  example: TK101
                from:
                  type: string
                  example: IST
                to:
                  type: string
                  example: JFK
                date:
                  type: string
                  example: 2026-05-20
                duration:
                  type: integer
                  example: 120
                price:
                  type: number
                  example: 500
                capacity:
                  type: integer
                  example: 200
      responses:
        200:
          description: Flight added successfully
        401:
          description: Unauthorized

  /v1/flights/delete:
    delete:
      summary: Delete a flight
      description: Delete a flight by ID (other parameters ignored but accepted).
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                id:
                  type: integer
                code:
                  type: string
                from:
                  type: string
                to:
                  type: string
                date:
                  type: string
                price:
                  type: number
                capacity:
                  type: integer
      responses:
        200:
          description: Flight deleted successfully
        404:
          description: Flight not found

  /v1/miles/add:
    post:
      summary: Add Miles to User Account (Admin Only)
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                username:
                  type: string
                  example: testuser
                amount:
                  type: integer
                  example: 1000
      responses:
        200:
          description: Miles added successfully
        401:
          description: Unauthorized

  /v1/miles/{username}:
    get:
      summary: Get User Miles
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: username
          required: true
          schema:
            type: string
          description: The username to retrieve miles for
      responses:
        200:
          description: User miles retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  username:
                    type: string
                    example: testuser
                  miles:
                    type: integer
                    example: 1000
        401:
          description: Unauthorized
        404:
          description: User not found

  /v1/search/flights:
    get:
      summary: Search for flights
      security: []
      parameters:
        - in: query
          name: from
          schema:
            type: string
          description: Origin city code
        - in: query
          name: to
          schema:
            type: string
          description: Destination city code
      responses:
        200:
          description: List of flights

  /v1/flights/buy:
    post:
      summary: Buy a ticket
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                flightId:
                  type: string
                passengerName:
                  type: string
                email:
                  type: string
      responses:
        200:
          description: Ticket purchased

  /api/predict:
    post:
      summary: Predict flight price (ML)
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                duration:
                  type: integer
                  example: 180
                class:
                  type: string
                  enum: [Economy, Business]
                  example: Economy
      responses:
        200:
          description: Predicted price

  /v1/auth/register:
    post:
      summary: Register for Miles&Smiles
      description: Create a new Miles & Smiles membership account (Cognito).
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                firstName:
                  type: string
                lastName:
                  type: string
                email:
                  type: string
                password:
                  type: string
                dob:
                  type: string
                  example: "1990-01-01"
      responses:
        201:
          description: Registration successful
        500:
          description: Internal Server Error

  /v1/miles-smiles/members:
    get:
      summary: List all Miles&Smiles Members
      responses:
        200:
          description: List of members
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    id:
                      type: integer
                    firstName:
                      type: string
                    lastName:
                      type: string
                    email:
                      type: string
                    memberId:
                      type: string

  /v1/miles-smiles/members/all:
    delete:
      summary: Delete ALL Members (Standard + Miles)
      description: WARNING! This action deletes ALL members from the database.
      responses:
        200:
          description: All members deleted successfully
        500:
          description: Server Error

  /v1/miles-smiles/members/{id}:
    delete:
      summary: Delete a Miles&Smiles Member
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
          description: The ID of the member to delete
      responses:
        200:
          description: Member deleted successfully
        404:
          description: Member not found
